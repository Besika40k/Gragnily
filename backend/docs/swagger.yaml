openapi: 3.0.0
info:
  title: Book API
  version: 1.0.0
  description: API to manage and fetch book records

servers:
  - url: https://gragnily.onrender.com
    description: Production server
  - url: http://localhost:8080
    description: Local development server

paths:
  /api/books:
    get:
      summary: Get all books
      tags: [Books]
      responses:
        200:
          description: List of Books
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/Book"
    post:
      tags:
        - Books
      summary: Create a new book
      description: Uploads a book with cover image, PDF(s), and optional EPUB file. Supports multilingual fields.
      operationId: createBook
      security:
        - bearerAuth: []
      requestBody:
        # required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                title_ge:
                  type: string
                author:
                  type: array
                  items:
                    type: string
                genre:
                  type: array
                  items:
                    type: string
                genre_ge:
                  type: array
                  items:
                    type: string
                publisher_name:
                  type: string
                publication_year:
                  type: integer
                language:
                  type: string
                language_ge:
                  type: string
                cover_image:
                  type: string
                  format: binary
                pdf_file:
                  type: array
                  items:
                    type: string
                    format: binary
                epub_file:
                  type: string
                  format: binary
              required:
                - title
                - title_ge
                - author
                - genre
                - genre_ge
                - language
                - language_ge
                - cover_image
                - pdf_file
      responses:
        '200':
          description: Book created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  book:
                    $ref: '#/components/schemas/Book'
        '500':
          description: Failed to create book
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  error:
                    type: string
  /api/books/{id}:
    get:
      summary: Get a book by ID
      description: Retrieve a book by its unique ID.
      tags:
        - Books
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to retrieve
          schema:
            type: string
      responses:
        200:
          description: Book retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  foundBook:
                    $ref: "#/components/schemas/Book"
        404:
          description: Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book not found"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Error on book.find"
                  error:
                    type: string
                    example: "Error message here"

    put:
      summary: Update an existing book
      description: Updates the details of a book by its ID. Write only what has to be changed in JSON
      tags: [Books]
      parameters:
        - name: id
          in: path
          description: The ID of the book to update
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  example: "New Book Title"
                author:
                  type: array
                  items:
                    type: string
                  example: ["Author Name"]
                genre:
                  type: string
                  example: "Fiction"
                publisher_name:
                  type: string
                  example: "Publisher Name"
                publication_year:
                  type: integer
                  example: 2023
                language:
                  type: string
                  example: "English"
      responses:
        200:
          description: Book updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book updated successfully"
                  book:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "643d1f9e8f1b2c001c8e4d5a"
                      title:
                        type: string
                        example: "New Book Title"
                      author:
                        type: array
                        items:
                          type: object
                          properties:
                            author_id:
                              type: string
                              example: "643d1f9e8f1b2c001c8e4d5b"
                            name:
                              type: string
                              example: "Author Name"
                      genre:
                        type: string
                        example: "Fiction"
                      publisher_name:
                        type: string
                        example: "Publisher Name"
                      publication_year:
                        type: integer
                        example: 2023
                      language:
                        type: string
                        example: "English"
        400:
          description: Book ID is required
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book ID is required"
        404:
          description: Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book Not Found"
        500:
          description: Error updating book
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Error updating Book"
                  errorMessage:
                    type: string
                    example: "Error message here"

    delete:
      summary: Delete a book
      description: Deletes a book by its ID.
      tags:
        - Books
      parameters:
        - name: id
          in: path
          required: true
          description: The ID of the book to delete.
          schema:
            type: string
            example: "643d1f4e8f1b2c0012345678"
      responses:
        "200":
          description: Book deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book deleted successfully"
                  book:
                    type: object
                    description: The deleted book object (if applicable).
        "400":
          description: Bad Request - Missing or invalid book ID
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book ID is required"
        "404":
          description: Book not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Book not found"
        "500":
          description: Internal Server Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Error deleting book"
                  error:
                    type: string
                    example: "Detailed error message"

  /api/books/search:
    get:
      summary: Search and preview books by title
      tags:
        - Books
      parameters:
        - in: query
          name: searchInput
          schema:
            type: string
          required: true
          description: Search keyword for book titles
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          required: false
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          required: false
          description: Number of items per page
      responses:
        '200':
          description: A list of books matching the search input
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    title:
                      type: string
                      example: "10 Tips for Better Sleep"
                    cover_image_url:
                      type: string
                      example: "https://cdn.example.com/images/book-cover.jpg"
                    score:
                      type: number
                      example: 12.34
        '500':
          description: Server error
  /api/authors:
    get:
      summary: Retrieve a list of authors
      tags: [Authors]
      description: Fetches all authors from the database.
      responses:
        "200":
          description: Successfully retrieved authors
          content:
            application/json:
              schema:
                type: object
                properties:
                  authors:
                    type: array
                    items:
                      $ref: "#/components/schemas/Author"
        "500":
          description: Internal server error
    post:
      summary: Create a new author
      tags:
        - Authors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "George Orwell"
                name_ge:
                  type: string
                  example: "ჯორჯ ორუელი"
                birth_year:
                  type: integer
                  example: 1903
                nationality:
                  type: string
                  example: "British"
      responses:
        '200':
          description: Author creation successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                  author:
                    $ref: '#/components/schemas/Author'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                  error:
                    type: string
  /api/authors/{id}:
    get:
      summary: Retrieve author by name
      tags: [Authors]
      description: Fetches an author by the provided name (ID) parameter.
      parameters:
        - name: id
          in: path
          required: true
          description: The name of the author to retrieve
          schema:
            type: string
      responses:
        "200":
          description: Successfully retrieved author
          content:
            application/json:
              schema:
                type: object
                properties:
                  authors:
                    type: array
                    items:
                      $ref: "#/components/schemas/Author"
        "404":
          description: Author not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                    example: "Author Not Found"
        "500":
          description: Internal server error
    put:
      summary: Update an existing author
      description: Updates the details of an author by their ID.
      tags: [Authors]
      parameters:
        - name: id
          in: path
          description: The ID of the author to update
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "John Doe"
                birth_year:
                  type: integer
                  example: 1980
                nationality:
                  type: string
                  example: "American"
      responses:
        200:
          description: Author successfully updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                    example: "Author successfully updated"
                  Author:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "643d1f9e8f1b2c001c8e4d5a"
                      name:
                        type: string
                        example: "John Doe"
                      birth_year:
                        type: integer
                        example: 1980
                      nationality:
                        type: string
                        example: "American"
        500:
          description: Error updating author
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                    example: "Error Updating Author"
                  error:
                    type: string
                    example: "Error message here"

    delete:
      summary: Delete an author
      description: Deletes an author by their ID.
      tags: [Authors]
      parameters:
        - name: id
          in: path
          description: The ID of the author to delete
          required: true
          schema:
            type: string
      responses:
        200:
          description: Author successfully deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                    example: "Author successfully deleted"
                  Author:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "643d1f9e8f1b2c001c8e4d5a"
                      name:
                        type: string
                        example: "John Doe"
                      birth_year:
                        type: integer
                        example: 1980
                      nationality:
                        type: string
                        example: "American"
        500:
          description: Error deleting author
          content:
            application/json:
              schema:
                type: object
                properties:
                  comment:
                    type: string
                    example: "Error Deleting Author"
                  error:
                    type: string
                    example: "Error message here"
  /api/auth/signUp:
    post:
      summary: User Registration
      description: Registers a new user and returns authentication tokens in cookies.
      operationId: signUp
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - email
                - password
              properties:
                username:
                  type: string
                  example: johndoe
                email:
                  type: string
                  format: email
                  example: johndoe@example.com
                password:
                  type: string
                  format: password
                  example: P@ssw0rd123
      responses:
        '200':
          description: Registration successful
          headers:
            Set-Cookie:
              description: Authentication and refresh tokens
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Registration successful
        '400':
          description: Bad Request (missing or invalid parameters)
        '500':
          description: Internal Server Error
  /api/auth/signin:
    post:
      summary: User login
      description: Authenticates a user and returns a JWT access token.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: The username of the user
                  example: "john_doe"
                password:
                  type: string
                  description: The password of the user
                  example: "password123"
      responses:
        200:
          description: User authenticated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    description: The unique ID of the user
                    example: "643d1f9e8f1b2c001c8e4d5a"
                  username:
                    type: string
                    description: The username of the user
                    example: "john_doe"
                  email:
                    type: string
                    description: The email of the user
                    example: "john.doe@example.com"
                  roles:
                    type: array
                    items:
                      type: string
                    description: List of roles assigned to the user
                    example: ["ROLE_ADMIN", "ROLE_USER"]
                  accessToken:
                    type: string
                    description: The JWT access token
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        401:
          description: Invalid credentials
          content:
            application/json:
              schema:
                type: object
                properties:
                  accessToken:
                    type: string
                    example: null
                  message:
                    type: string
                    example: "Invalid Password!"
        404:
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User Not Found!"
        500:
          description: Internal server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Error message here"
  /api/auth/logout:
    post:
      summary: Logs the user out
      description: Clears the refresh and access token cookies if they exist.
      tags:
        - Authentication
      responses:
        '200':
          description: User successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User Logged Out
        '201':
          description: User was already logged out (no tokens to clear)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: User Already Logged Out
  /api/users/:
    get:
      summary: Get all users (admin only)
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of users
        '404':
          description: Users Not Found

  /api/users/getuser:
    get:
      summary: Get current user (lite version)
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Returns username, email, and profile picture
        '401':
          description: User Not Registered
        '404':
          description: User Not Found

  /api/users/updateuser:
    put:
      summary: Update text fields of current user
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
      responses:
        '200':
          description: User updated successfully
        '401':
          description: User Not Signed In

  /api/users/updateuserprofile:
    put:
      summary: Upload or update user profile picture
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                new_profile:
                  type: string
                  format: binary
      responses:
        '200':
          description: Profile Picture Updated
        '401':
          description: User Not Signed In
        '500':
          description: Can't read profile uploaded

  /api/users/deleteuser:
    delete:
      summary: Delete current user
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User Deleted Successfully
        '401':
          description: User Not Signed In
        '404':
          description: User Not Found
components:
  securitySchemes:
    xAccessToken:
      type: apiKey
      in: header
      name: x-access-token
  schemas:
    Author:
      type: object
      properties:
        _id:
          type: string
        name:
          type: string
        name_ge:
          type: string
        birth_year:
          type: integer
        nationality:
          type: string
    Book:
      type: object
      properties:
        _id:
          type: string
        title:
          type: string
        title_ge:
          type: string
        author:
          type: array
          items:
            type: object
            properties:
              author_id:
                type: string
        genre:
          type: array
          items:
            type: string
        genre_ge:
          type: array
          items:
            type: string
        publisher_name:
          type: string
        publication_year:
          type: integer
        language:
          type: string
        language_ge:
          type: string
        page_count:
          type: integer
        cover_image_url:
          type: string
        ci_public_id:
          type: string
        pdf_url:
          type: array
          items:
            type: string
        pdf_public_id:
          type: array
          items:
            type: string
        epub_url:
          type: string
        epub_public_id:
          type: string
